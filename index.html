<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IELTS Actual · Glassmorphism OAuth</title>
  <!-- Google Fonts & Font Awesome 6 -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at 10% 30%, #0b0f1c, #14182b, #1e1a2f, #19152a);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      color: white;
    }

    .glass-card {
      background: rgba(20, 25, 45, 0.65);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 40px;
      box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.6);
    }

    .glass-nav {
      background: rgba(12, 16, 30, 0.6);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 60px;
      padding: 0.8rem 2rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }

    .btn-google {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      background: white;
      color: #0f172a;
      border: none;
      padding: 14px 36px;
      border-radius: 50px;
      font-weight: 600;
      font-size: 1.1rem;
      letter-spacing: 0.3px;
      transition: all 0.2s ease;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      cursor: pointer;
      text-decoration: none;
    }

    .btn-google:hover {
      transform: scale(1.02);
      box-shadow: 0 12px 32px rgba(0,0,0,0.3);
      background: #f8faff;
    }

    .social-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.1);
      color: white;
      font-size: 1.3rem;
      transition: 0.2s;
    }

    .social-icon:hover {
      background: rgba(255,255,255,0.15);
      transform: translateY(-3px);
    }

    .maintenance-icon {
      font-size: 4.5rem;
      color: rgba(220, 230, 255, 0.7);
      margin-bottom: 1rem;
    }

    .footer {
      color: rgba(200, 210, 240, 0.7);
      font-size: 0.9rem;
      border-top: 1px solid rgba(255,255,255,0.06);
      padding-top: 1.8rem;
      margin-top: 3rem;
      text-align: center;
    }

    #app {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }

    .hidden {
      display: none !important;
    }

    .fade-in {
      animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* floating navbar effect */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4rem;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(145deg, #eef2ff, #cbd5e1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-links {
      display: flex;
      gap: 2.5rem;
      color: rgba(255,255,255,0.8);
    }

    .nav-links a {
      color: inherit;
      text-decoration: none;
      font-weight: 500;
    }

    /* Dashboard social flex */
    .social-row {
      display: flex;
      gap: 1.2rem;
      justify-content: center;
      margin-top: 1.8rem;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Floating Navigation (Glassmorphism) -->
    <nav class="navbar glass-nav fade-in">
      <span class="logo">IELTS ACTUAL</span>
      <div class="nav-links">
        <a href="#">Home</a>
        <a href="#">Tests</a>
        <a href="#">Academy</a>
      </div>
    </nav>

    <!-- ---------- LOGIN SECTION (default visible) ---------- -->
    <div id="login-section" class="fade-in">
      <div class="glass-card" style="max-width: 620px; margin: 0 auto; padding: 3rem 2.5rem; text-align: center;">
        <h1 style="font-size: 2.8rem; font-weight: 600; margin-bottom: 0.5rem; letter-spacing: -0.02em;">Welcome back</h1>
        <p style="color: rgba(210, 220, 250, 0.9); font-size: 1.2rem; margin-bottom: 2.8rem;">Sign in to continue your IELTS journey</p>
        
        <!-- Google Sign-in Button (direct backend redirect) -->
        <a href="https://ielts-backend-5b7q.onrender.com/auth/google" class="btn-google" id="google-login-btn">
          <i class="fab fa-google" style="color: #4285F4; font-size: 1.3rem;"></i>
          Sign up for free with Google
        </a>
        
        <!-- Social proof comment -->
        <div style="margin-top: 2rem; background: rgba(255,255,255,0.03); padding: 1rem; border-radius: 60px; backdrop-filter: blur(4px);">
          <p style="color: #b3c6ff; font-size: 1rem; font-weight: 400;">
            <i class="fas fa-check-circle" style="color: #6ee7b7; margin-right: 8px;"></i>
            It's 100% free, just one click away! 
            <span style="display: inline-block; margin-left: 10px; background: rgba(255,255,255,0.1); padding: 0.2rem 1rem; border-radius: 30px;">✨ 50,000+ learners</span>
          </p>
        </div>
        
        <p style="color: rgba(200, 210, 240, 0.6); margin-top: 2.2rem; font-size: 0.9rem;">
          <i class="fas fa-shield-alt" style="margin-right: 6px;"></i> Secure OAuth · we never see your password
        </p>
      </div>
    </div>

    <!-- ---------- DASHBOARD SECTION (hidden by default) ---------- -->
    <div id="dashboard-section" class="hidden fade-in">
      <div class="glass-card" style="max-width: 780px; margin: 0 auto; padding: 2.8rem 2.5rem; text-align: center;">
        <!-- Maintenance illustration (Font Awesome icon) -->
        <div class="maintenance-icon">
          <i class="fas fa-tools"></i>
        </div>
        
        <h2 style="font-size: 2.2rem; font-weight: 600; margin-bottom: 0.8rem; background: linear-gradient(135deg, #f0e6ff, #d9e2ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
          Maintenance Mode
        </h2>
        
        <p style="color: #cdd6f4; font-size: 1.2rem; margin-bottom: 1.8rem; max-width: 500px; margin-left: auto; margin-right: auto;">
          <i class="fas fa-exclamation-triangle" style="color: #ffd166; margin-right: 8px;"></i>
          The web page is being updated. Be aware that some features may be temporarily unavailable.
        </p>
        
        <!-- Social media icons (glass style) -->
        <div style="margin-top: 2rem;">
          <p style="color: rgba(220, 230, 255, 0.8); margin-bottom: 1rem; font-weight: 400;">Stay connected</p>
          <div class="social-row">
            <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-youtube"></i></a>
          </div>
        </div>
        
        <!-- Sign out button -->
        <button id="logout-btn" style="margin-top: 2.8rem; padding: 0.9rem 2.2rem; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); border-radius: 40px; color: white; font-size: 1rem; font-weight: 500; backdrop-filter: blur(10px); cursor: pointer; transition: 0.2s;">
          <i class="fas fa-sign-out-alt" style="margin-right: 8px;"></i> Sign out
        </button>
      </div>
    </div>

    <!-- FOOTER (global) -->
    <footer class="footer">
      © 2026 IELTS Actual. All rights reserved. Designed by Otabek.
    </footer>
  </div>

  <script>
    (function() {
      "use strict";

      // ----- Configuration -----
      const BACKEND_AUTH_URL = "https://ielts-backend-5b7q.onrender.com/auth/google";
      const STORAGE_KEY = "ielts_user";

      // ----- DOM elements -----
      const loginSection = document.getElementById("login-section");
      const dashboardSection = document.getElementById("dashboard-section");
      const logoutBtn = document.getElementById("logout-btn");

      // ----- Helper: parse user data from URL (after backend redirect) -----
      function getUserFromUrl() {
        const params = new URLSearchParams(window.location.search);
        // Expecting backend to redirect with ?name=...&email=...&picture=...&id=...
        const name = params.get("name");
        const email = params.get("email");
        const picture = params.get("picture");
        const id = params.get("id");
        
        if (name && email) {
          return { name, email, picture, id };
        }
        return null;
      }

      // ----- Save user to localStorage and clean URL -----
      function persistUserAndCleanUrl(user) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(user));
        // Remove query parameters without reloading the page
        const cleanUrl = window.location.origin + window.location.pathname;
        window.history.replaceState({}, document.title, cleanUrl);
      }

      // ----- Show dashboard, hide login -----
      function showDashboard(user) {
        loginSection.classList.add("hidden");
        dashboardSection.classList.remove("hidden");
        // Optional: display user info somewhere (greeting)
        // You could add a small avatar/name in navbar if you want – here we keep it minimal.
      }

      // ----- Show login, hide dashboard -----
      function showLogin() {
        loginSection.classList.remove("hidden");
        dashboardSection.classList.add("hidden");
      }

      // ----- Logout: clear localStorage and show login -----
      function logout() {
        localStorage.removeItem(STORAGE_KEY);
        showLogin();
      }

      // ----- Initialize UI based on stored user OR URL data -----
      function init() {
        // 1. Check if we have user data in URL (fresh login redirect)
        const urlUser = getUserFromUrl();
        if (urlUser) {
          persistUserAndCleanUrl(urlUser);
          showDashboard(urlUser);
          return;
        }

        // 2. Check localStorage for existing session
        const storedUser = localStorage.getItem(STORAGE_KEY);
        if (storedUser) {
          try {
            const user = JSON.parse(storedUser);
            showDashboard(user);
          } catch (e) {
            localStorage.removeItem(STORAGE_KEY);
            showLogin();
          }
        } else {
          showLogin();
        }
      }

      // ----- Attach event listener to logout button -----
      if (logoutBtn) {
        logoutBtn.addEventListener("click", logout);
      }

      // ----- Make sure the Google button always points to the backend -----
      const googleBtn = document.getElementById("google-login-btn");
      if (googleBtn) {
        googleBtn.href = BACKEND_AUTH_URL;  // enforce correct URL
      }

      // ----- Run initialization -----
      init();
    })();
  </script>
</body>
</html>
